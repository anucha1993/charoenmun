<div class="container-fluid py-3">
    <div class="row">
        <!-- Sidebar Filter -->
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="mb-3">üîç ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</h5>
                    
                    <div class="list-group mb-4">
                        <button class="list-group-item list-group-item-action {{ $filterType === 'today' ? 'active' : '' }}"
                            wire:click="setFilter('today')">
                            <i class="ri-calendar-todo-fill"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                        </button>
                        <button class="list-group-item list-group-item-action {{ $filterType === 'pending' ? 'active' : '' }}"
                            wire:click="setFilter('pending')">
                            <i class="ri-error-warning-fill"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        </button>
                        <button class="list-group-item list-group-item-action {{ $filterType === 'date-range' ? 'active' : '' }}"
                            wire:click="setFilter('date-range')">
                            <i class="ri-calendar-check-fill"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                        </button>
                    </div>

                    @if($filterType === 'date-range')
                    <div class="mb-3">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="date" class="form-control" wire:model.live="startDate">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="date" class="form-control" wire:model.live="endDate">
                    </div>
                    @endif

                    <div class="mb-3">
                        <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                        <select class="form-select" wire:model.live="deliveryStatus">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="pending">‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
                            <option value="success">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
                            <option value="cancelled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                        </select>
                    </div>

                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö -->
                    @if($pendingDeliveries->isNotEmpty())
                    <div class="alert alert-warning">
                        <h6 class="alert-heading">‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h6>
                        <hr>
                        @foreach($pendingDeliveries as $pending)
                        <div class="mb-2">
                            <strong>{{ $pending->order_delivery_number }}</strong><br>
                            <small>{{ $pending->order->customer->customer_name }}<br>
                                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ $pending->order_delivery_date->format('d/m/Y') }}<br>
                                ‡∏¢‡∏≠‡∏î: {{ number_format($pending->order_delivery_grand_total, 2) }} ‡∏ö‡∏≤‡∏ó</small>
                        </div>
                        @endforeach
                    </div>
                    @endif
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9">
            <!-- Stats -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card border-0 bg-success bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-success mb-2">üìÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h6>
                                    <h4 class="mb-0">{{ number_format($stats['today']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-success">{{ number_format($stats['today']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 bg-warning bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-warning mb-2">‚ö†Ô∏è ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h6>
                                    <h4 class="mb-0">{{ number_format($stats['pending']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-warning">{{ number_format($stats['pending']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 bg-primary bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-primary mb-2">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</h6>
                                    <h4 class="mb-0">{{ number_format($stats['success']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-primary">{{ number_format($stats['success']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly/Yearly Stats -->
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card border-0 bg-info bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-info mb-2">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h6>
                                    <h4 class="mb-0">{{ number_format($stats['monthly']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-info">{{ number_format($stats['monthly']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 bg-secondary bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-secondary mb-2">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</h6>
                                    <h4 class="mb-0">{{ number_format($stats['yearly']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-secondary">{{ number_format($stats['yearly']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scan Input -->
            <div class="container-fluid py-3">
    <div class="row">
        <!-- Sidebar Filter -->
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="mb-3">üîç ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</h5>
                    
                    <div class="list-group mb-4">
                        <button class="list-group-item list-group-item-action {{ $filterType === 'today' ? 'active' : '' }}"
                            wire:click="setFilter('today')">
                            <i class="ri-calendar-todo-fill"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                        </button>
                        <button class="list-group-item list-group-item-action {{ $filterType === 'pending' ? 'active' : '' }}"
                            wire:click="setFilter('pending')">
                            <i class="ri-error-warning-fill"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        </button>
                        <button class="list-group-item list-group-item-action {{ $filterType === 'date-range' ? 'active' : '' }}"
                            wire:click="setFilter('date-range')">
                            <i class="ri-calendar-check-fill"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                        </button>
                    </div>

                    @if($filterType === 'date-range')
                    <div class="mb-3">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="date" class="form-control" wire:model.live="startDate">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="date" class="form-control" wire:model.live="endDate">
                    </div>
                    @endif

                    <div class="mb-3">
                        <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                        <select class="form-select" wire:model.live="deliveryStatus">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="pending">‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
                            <option value="success">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
                            <option value="cancelled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                        </select>
                    </div>

                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö -->
                    @if($pendingDeliveries->isNotEmpty())
                    <div class="alert alert-warning">
                        <h6 class="alert-heading">‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h6>
                        <hr>
                        @foreach($pendingDeliveries as $pending)
                        <div class="mb-2">
                            <strong>{{ $pending->order_delivery_number }}</strong><br>
                            <small>{{ $pending->order->customer->customer_name }}<br>
                                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ $pending->order_delivery_date->format('d/m/Y') }}<br>
                                ‡∏¢‡∏≠‡∏î: {{ number_format($pending->order_delivery_grand_total, 2) }} ‡∏ö‡∏≤‡∏ó</small>
                        </div>
                        @endforeach
                    </div>
                    @endif
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9">
            <!-- Stats -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card border-0 bg-success bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-success mb-2">üìÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h6>
                                    <h4 class="mb-0">{{ number_format($stats['today']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-success">{{ number_format($stats['today']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 bg-warning bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-warning mb-2">‚ö†Ô∏è ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h6>
                                    <h4 class="mb-0">{{ number_format($stats['pending']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-warning">{{ number_format($stats['pending']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 bg-primary bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-primary mb-2">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</h6>
                                    <h4 class="mb-0">{{ number_format($stats['success']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-primary">{{ number_format($stats['success']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly/Yearly Stats -->
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card border-0 bg-info bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-info mb-2">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h6>
                                    <h4 class="mb-0">{{ number_format($stats['monthly']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-info">{{ number_format($stats['monthly']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 bg-secondary bg-opacity-10">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="text-secondary mb-2">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</h6>
                                    <h4 class="mb-0">{{ number_format($stats['yearly']['count']) }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                                    <small class="text-secondary">{{ number_format($stats['yearly']['amount'], 2) }} ‡∏ö‡∏≤‡∏ó</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scan Input -->
            <div class="container-fluid py-3">
    <div class="row">
        <!-- Sidebar Filter -->
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="mb-3">üîç ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</h5>

            @if($currentDelivery)
            <!-- Current Scanned Order -->
            <div class="card mb-4 border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏•:</strong> {{ $currentDelivery->order_delivery_number }}</p>
                            <p><strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> {{ $order->customer->customer_name }}</p>
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</strong> {{ $currentDelivery->order_delivery_date->format('d/m/Y') }}</p>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-warning" wire:click="cancelSuccess({{ $currentDelivery->id }})">
                                <i class="ri-restart-line"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                            </button>
                            <a href="{{ route('orders.show', $order->id) }}" class="btn btn-info" target="_blank">
                                <i class="ri-external-link-line"></i> ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            @endif

            @if(!$currentDelivery && !$deliveries->count())
            <div class="text-center py-5 text-muted">
                <i class="ri-qr-scan-2-line" style="font-size: 64px;"></i>
                <p class="mt-3">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏¥‡∏á QR Code ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
            </div>
            @endif

            <!-- Deliveries Table -->
            @if($deliveries->count() > 0)
            <div class="card">
                <div class="card-body">
                    <h5 class="mb-3">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏•</th>
                                    <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                                    <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($deliveries as $delivery)
                                <tr>
                                    <td>{{ $delivery->order_delivery_date->format('d/m/Y') }}</td>
                                    <td>{{ $delivery->order_delivery_number }}</td>
                                    <td>{{ $delivery->order->customer->customer_name }}</td>
                                    <td>{{ number_format($delivery->order_delivery_grand_total, 2) }}</td>
                                    <td>
                                        @if($delivery->order_delivery_status === 'success')
                                            <span class="badge bg-success">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
                                        @elseif($delivery->order_delivery_status === 'pending')
                                            <span class="badge bg-warning">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                                        @else
                                            <span class="badge bg-danger">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                                        @endif
                                    </td>
                                    <td>
                                        @if($delivery->order_delivery_status === 'success')
                                        <button class="btn btn-sm btn-warning" wire:click="cancelSuccess({{ $delivery->id }})">
                                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                                        </button>
                                        @endif
                                        <a href="{{ route('orders.show', $delivery->order->id) }}" 
                                           class="btn btn-sm btn-info" target="_blank">
                                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                                        </a>
                                    </td>
                                </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        {{ $deliveries->links() }}
                    </div>
                </div>
            </div>
            @endif
        @php
            $totalConfirmed = $order && $order->deliveries ? $order->deliveries->flatMap->payments->where('status', '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß')->sum('amount') : 0;
            $totalWaiting = $order && $order->deliveries ? $order->deliveries->flatMap->payments->where('status', '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î')->sum('amount') : 0;
        @endphp



        @if($order)
            <div class="card mb-0 shadow-sm">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">üìÑ ‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: {{ $order->order_number }}</h5>
                    <span>{{ $order->order_date->format('d/m/Y') }}</span>
                </div>
                <div class="card-body">
                    <div class="row mb-0">
                        <div class="col-md-6">
                            <h6>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h6>
                            @if($order->customer)
                                <p class="mb-1"><strong>{{ $order->customer->customer_name }}</strong></p>
                                <p class="mb-1">{{ $order->customer->customer_address }}</p>
                                <p class="mb-1">
                                    {{ $order->customer->customer_district_name }},
                                    {{ $order->customer->customer_amphur_name }},
                                    {{ $order->customer->customer_province_name }} {{ $order->customer->customer_zipcode }}
                                </p>
                                <p>‡πÇ‡∏ó‡∏£: {{ $order->customer->customer_phone }}</p>
                            @else
                                <p class="text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                            @endif
                        </div>
                        <div class="col-md-6">
                            <h6>üöö ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h6>
                            @if ($order->deliveryAddress)
                                <p class="mb-1">{{ $order->deliveryAddress->delivery_contact_name }}
                                    ({{ $order->deliveryAddress->delivery_phone }})</p>
                                <p class="mb-1">{{ $order->deliveryAddress->delivery_number }}</p>
                                <p>
                                    {{ $order->deliveryAddress->delivery_address }}
                                </p>
                            @else
                                <span class="text-muted">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                            @endif
                        </div>
                    </div>
                    <hr>

                    <div class="row mb-0">
                        <div class="col-md-6">
                            <h6>üí≥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h6>
                            <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: {!! order_status_badge($order->order_status) !!}</p>
                            <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: {!! payment_status_badge($order->payment_status) !!}</p>
                            <p>‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î: <span class="text-warning">{{ number_format($totalWaiting, 2) }} ‡∏ö‡∏≤‡∏ó</span></p>
                            <p>‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß: <span class="text-success">{{ number_format($totalConfirmed, 2) }} ‡∏ö‡∏≤‡∏ó</span></p>
                        </div>
                        <div class="col-md-6">
                            <h6>üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</h6>
                            <p>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: {{ number_format($order->order_discount, 2) }} ‡∏ö‡∏≤‡∏ó</p>
                            <p>VAT: {{ number_format($order->order_vat, 2) }} ‡∏ö‡∏≤‡∏ó</p>
                            <p><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {{ number_format($order->order_grand_total, 2) }} ‡∏ö‡∏≤‡∏ó</strong></p>
                        </div>
                    </div>

                    @if($order->items)
                        <h6 class="mb-2">üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h6>
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>#</th>
                                        <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                        <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏±‡πà‡∏á</th>
                                        <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                        <th class="text-end">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach ($order->items as $idx => $item)
                                        @php
                                            $delivered = $deliveredQtyMap[$item->product_id] ?? 0;
                                        @endphp
                                        <tr>
                                            <td>{{ $idx + 1 }}</td>
                                            <td>{{ $item->product_name }}</td>
                                            <td>{{ $item->product_detail }}</td>
                                            <td>{{ $item->quantity }} {{ $delivered > 0 ? '(' . $delivered . ')' : '' }}</td>
                                            <td>{{ $item->product_unit }}</td>
                                            <td>{{ number_format($item->unit_price, 2) }}</td>
                                            <td class="text-end">{{ number_format($item->total, 2) }}</td>
                                        </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    @endif

                <h6 class="mt-4">üöö ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h6>
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•‡∏¢‡πà‡∏≠‡∏¢</th>
                            <th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if($order && $order->deliveries)
                        @foreach ($order->deliveries as $delivery)
                            <tr>
                                <td>{{ $delivery->order_delivery_date->format('d/m/Y') }}</td>
                                <td>{{ $delivery->order_delivery_number }}</td>
                                <td>{{ number_format($delivery->order_delivery_grand_total, 2) }}</td>
                                <td>{!! order_delivery_status_badge($delivery->order_delivery_status) !!}</td>
                                <td>{!! payment_status_badge($delivery->payment_status) !!}</td>
                            </tr>
                        @endforeach
                    @endif
                    </tbody>
                </table>
                </div>
            </div>
        @endif
    </div>
</div>
